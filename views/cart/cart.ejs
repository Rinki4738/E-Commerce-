<% layout('layouts/boilerplate') %>
<%- include('../partials/nav') %>

<div class="container mt-4">
    <h2 class="mb-4">Your Cart</h2>

    <% let total = 0; %>

    <% if (user.cart.length === 0) { %>
        <p>Your cart is empty.</p>
    <% } else { %>
        <ul class="list-group mb-4">
            <% for (let item of user.cart) { %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <img src="<%= item.image %>" alt="<%= item.name %>" width="60" height="60" class="me-3 rounded" />
                        <div>
                            <strong><%= item.name %></strong><br>
                            ₹<%= item.price %>
                        </div>
                    </div>
                    <form action="/user/cart/<%= item._id %>/remove?_method=DELETE" method="POST" style="margin: 0;">
                        <button type="submit" class="btn btn-sm btn-danger" title="Remove Item">&times;</button>
                    </form>
                </li>
                <% total += item.price; %>
            <% } %>
        </ul>

        <div class="d-flex justify-content-between align-items-center">
            <h4>Total: ₹<%= total %></h4>
        </div>

        <form action="/payment_gateway/payumoney" method="POST" class="mt-3">
            <input type="hidden" name="amount" value="<%= total %>" />
            <input type="hidden" name="phone" value="9999999999" />
            <input type="hidden" name="service_provider" value="payu_paisa" />
            <input type="hidden" name="productinfo" value="educational purpose" />
            <button type="submit" class="btn btn-success btn-lg">Pay ₹<%= total %></button>
        </form>
    <% } %>
</div>
